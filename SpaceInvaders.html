<!DOCTYPE html>
<html>
<head>
	<title>Space Invaders</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
	<style>
	canvas {
		border: 1px solid black;
		background: black;
	}

	</style>
</head>
<body onload="startGame()">
	<div>
		<canvas id='game'></canvas>
	</div>

	<script>
		var player;

		var game = {
			canvas: document.getElementById('game'),
			components: [],
			enemys: [],
			keys: [],
			lasers: [],
			render: function(){
				this.canvas.width = 500;
				this.canvas.height = 500;
				this.context = this.canvas.getContext('2d');
				document.body.insertBefore(this.canvas, document.body.childNodes[0]);
				this.interval = setInterval(updateGameArea, 20);
				window.addEventListener('keydown', function(e){
					game.keys = (game.keys || []);
					game.keys[e.keyCode] = true;
				});
				window.addEventListener('keyup', function(e){
					game.keys[e.keyCode] = false;
					if (player.canShoot){
						player.shot = false;
					}
				});
			},
			clear: function(){
				this.context.clearRect(0,0,this.canvas.width,this.canvas.height);
			}
		}

//==============================================================================
//
//								OBJECTS
//
//==============================================================================

		function player(){
			this.width = 50;
			this.height = 30;
			this.x = 250;
			this.y = 460;
			this.lives = 3;
			this.points = 0;
			this.speed = 2;
			this.shot = false;
			this.canShoot = true;
			this.update = function(){
				var ctx = game.context;
				ctx.fillStyle = "green";
				ctx.fillRect(this.x, this.y, this.width, this.height);
			};
			this.shoot = function(){
				player.shot = true;
				player.canShoot = false;
				game.lasers.push(new laser('blue', 15,'up',this.x+this.width/2, this.y+this.height/2));
				setTimeout(function(){
					player.canShoot = true;
					if (!game.keys[32]){ player.shot = false; }
				}, 420);
			};
		}

		function enemy(color, speed, x, y, dir){
			this.height = 16;
			this.width = 22;
			this.color = color;
			this.speed = speed;
			this.x = x;
			this.y = y;
			this.left = x-98;
			this.right = x+46;
			this.direction = dir;
			this.update = function(){
				if (this.direction == 'left'){
					if (this.x > this.left){
						this.x -= this.speed;
					} else {
						this.direction = 'right';
						// this.y += 10; // falling
					}
				} else if (this.direction = 'right'){
					if (this.x < this.right){
						this.x += this.speed;
					} else {
						this.direction = 'left';
						// this.y += 10; // falling
					}
				}

				var ctx = game.context;
				ctx.fillStyle = this.color;
				ctx.fillRect(this.x, this.y, this.width, this.height);
			};
			this.shoot = function(){

			}
		}

		function laser(color, speed, dir, x, y){
			this.height = 4;
			this.width = 2;
			this.color = color;
			this.speed = speed;
			this.x = x;
			this.y = y;
			this.direction = dir;
			this.update = function(){
				if (this.direction == 'up'){
					this.y -= this.speed;
				} else if (this.direction = 'down'){
					this.y += this.speed;
				}
				if (this.y > game.canvas.height || this.y < 0-this.height){
					return -1;
				}
				for (i in game.enemys){
					if (colliding(this, game.enemys[i])){
						return i;
						console.log('boom');
					}
				}

				var ctx = game.context;
				ctx.fillStyle = this.color;
				ctx.fillRect(this.x, this.y, this.width, this.height);
			};
		}

//==============================================================================
//
//								HELPERS
//
//==============================================================================

		function colliding(rect1, rect2){
			if (rect1.x < rect2.x + rect2.width && rect1.x + rect1.width > rect2.x &&
				rect1.y < rect2.y + rect2.height && rect1.height + rect1.y > rect2.y)
			{
				return true
			}
			return false;
		}

		function levelOne(){
			var x = 100;
			for (i = 0; i < 11; i++){
				game.enemys.push(new enemy('white', 1, x, 20, 'right'));
				game.enemys.push(new enemy('white', 1, x, 50, 'right'));
				game.enemys.push(new enemy('white', 1, x, 80, 'right'));
				game.enemys.push(new enemy('white', 1, x, 110, 'right'));
				game.enemys.push(new enemy('white', 1, x, 140, 'right'));
				x += 33;
			}
		}

//==============================================================================
//
//								GAME
//
//==============================================================================

		function startGame(){
			game.render();
			player = new player();
			game.components.push(player);
			levelOne()
		}

		function updateGameArea(){
			game.clear();
			if(game.keys){
				if(game.keys[37]){ //left
					if(player.x > 0){
						player.x -= player.speed;
					}
				}
				// if (game.keys[38]){ //up
				// 	if(player.y > game.canvas.height-50){
				// 		player.y -= player.speed;
				// 	}
				// }
				if (game.keys[39]){ //right
					if(player.x < game.canvas.width-player.width){
						player.x += player.speed;
					}
				}
				// if (game.keys[40]){ //down
				// 	if(player.y < game.canvas.height-player.height){
				// 		player.y += player.speed;
				// 	}
				// }
				if (game.keys[32] == true && player.canShoot && !player.shot){ //space
					player.shoot();
				}
			}

			for (var i = 0; i < game.components.length ; i++){
				game.components[i].update();
			}
			for (var i = 0; i < game.enemys.length ; i++){
				game.enemys[i].update();
			}
			for (var i = 0; i < game.lasers.length ; i++){
				var laserState = game.lasers[i].update();
				// collided with enemy
				if (laserState >= 0){
					game.enemys.splice(laserState, 1);
				}
				// collided or out of bounds
				if (laserState >= -1){
					game.lasers.splice(i, 1);
				}
			}
		}


	</script>

</body>
</html>
